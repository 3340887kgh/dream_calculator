<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>낙원 계산기</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      line-height: 1.6;
      max-width: 600px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .form-group {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    .form-group label {
      width: 120px;
    }
    .form-group input {
      width: 150px;
      padding: 5px;
      text-align: right; /* 숫자 오른쪽 정렬 */
    }
    .form-group span {
      margin-left: 5px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2em;
    }
    .hint {
      color: #666;
      margin-left: 10px;
    }
  </style>
</head>
<body>

  <h1>낙원 계산기</h1>
  <p>아래 값을 입력하면, 은퇴(낙원) 후 예상 자산이 즉시 계산됩니다.</p>

  <!-- 보유 자산 -->
  <div class="form-group">
    <label for="B36">보유 자산</label>
    <input type="text" id="B36" placeholder="예: 100000000" />
    <span>원</span>
    <!-- (xx만원/xx억원/...) 표기용 -->
    <span id="B36_million" class="hint">(0원)</span>
  </div>

  <!-- 연간 저축 금액 -->
  <div class="form-group">
    <label for="B37">연간 저축 금액</label>
    <input type="text" id="B37" placeholder="예: 12000000" />
    <span>원</span>
    <span id="B37_million" class="hint">(0원)</span>
  </div>

  <!-- 기간 (N년) -->
  <div class="form-group">
    <label for="B38">기간</label>
    <input type="number" id="B38" placeholder="예: 25" />
    <span>년</span>
  </div>

  <!-- 명목 수익률 -->
  <div class="form-group">
    <label for="B39">명목 수익률</label>
    <input type="number" id="B39" placeholder="예: 5" step="0.1" />
    <span>%</span>
  </div>

  <!-- 저축 증가율 -->
  <div class="form-group">
    <label for="B40">저축 증가율</label>
    <input type="number" id="B40" placeholder="예: 3" step="0.1" />
    <span>%</span>
  </div>

  <!-- 계산 결과 -->
  <div class="result">
    은퇴 후 자산: <span id="resultValue">0</span> 원
  </div>

  <script>
    /************************************************************
     * 1) 숫자 → 만원/억/조/경/해 단위로 변환하는 함수
     ************************************************************/
    function formatKoreanUnits(valueInWon) {
      // 음수나 0 처리를 간단화하기 위해 양수만 가정(필요시 절댓값 처리 가능)
      if (valueInWon < 10000) {
        // 만원 미만 => 원 그대로
        return valueInWon.toLocaleString() + "원";
      }

      // 10^4 = 1만
      // 10^8 = 1억
      // 10^12 = 1조
      // 10^16 = 1경
      // 10^20 = 1해
      const UNIT_1MAN = 1e4;   // 만
      const UNIT_1EOK = 1e8;   // 억
      const UNIT_1JO  = 1e12;  // 조
      const UNIT_1GYEONG = 1e16; // 경
      const UNIT_1HAE = 1e20;  // 해

      // 해 이상이면 전체 숫자만 원으로 표기
      if (valueInWon >= UNIT_1HAE) {
        return valueInWon.toLocaleString() + "원";
      } else if (valueInWon >= UNIT_1GYEONG) {
        // 경 단위
        const val = valueInWon / UNIT_1GYEONG;
        // 소수점 표시 (원하는 자리까지 조정 가능, 여기서는 2자리 정도)
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "경원";
      } else if (valueInWon >= UNIT_1JO) {
        // 조 단위
        const val = valueInWon / UNIT_1JO;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "조원";
      } else if (valueInWon >= UNIT_1EOK) {
        // 억 단위
        const val = valueInWon / UNIT_1EOK;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "억원";
      } else {
        // 만 단위
        const val = valueInWon / UNIT_1MAN;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "만원";
      }
    }

    /************************************************************
     * 2) 입력 필드에 콤마 추가 + (만원/억/조/경/해) 표기
     ************************************************************/
    function formatInputAndDisplayUnit(id) {
      const inputElement = document.getElementById(id);
      // 기존 값에서 콤마 제거
      let rawValueString = inputElement.value.replaceAll(",", "");
      // 숫자로 변환 (NaN 방지)
      let rawValue = parseFloat(rawValueString) || 0;

      // 3자리마다 콤마 추가
      let formattedValue = rawValue.toLocaleString();
      // 인풋에 다시 세팅
      inputElement.value = formattedValue;

      // (xx만원/xx억원/...) 표기
      const spanElement = document.getElementById(id + "_million");
      if (spanElement) {
        spanElement.textContent = "(" + formatKoreanUnits(rawValue) + ")";
      }
    }

    /************************************************************
     * 3) 낙원(은퇴) 후 자산 계산 (엑셀 공식 그대로 적용)
     ************************************************************/
    function calculateRetirementAsset() {
      // 각 입력값 가져오기 (보유 자산, 저축 금액은 콤마 제거 후 파싱)
      const rawB36 = document.getElementById('B36').value.replaceAll(",", "") || "0";
      const rawB37 = document.getElementById('B37').value.replaceAll(",", "") || "0";
      const B36 = parseFloat(rawB36); // 보유 자산
      const B37 = parseFloat(rawB37); // 연간 저축 금액
      const B38 = parseInt(document.getElementById('B38').value) || 0;    // 기간(년)
      const B39 = parseFloat(document.getElementById('B39').value) || 0;  // 명목 수익률(%)
      const B40 = parseFloat(document.getElementById('B40').value) || 0;  // 저축 증가율(%)

      // 퍼센트를 소수로 변환 (5% -> 0.05)
      const nominalRate = B39 / 100;
      const savingGrowthRate = B40 / 100;

      // Excel 공식 (IF문)
      // = IF(
      //   B39 = B40,
      //   B36 * (1 + B39)^B38 + B37 * B38 * (1 + B39)^(B38 - 1),
      //   B36 * (1 + B39)^B38 + B37 * (
      //       ((1 + B39)^B38 - (1 + B40)^B38)
      //       / (B39 - B40)
      //     )
      // )
      let result = 0;
      if (nominalRate === savingGrowthRate) {
        // B39 == B40
        result = B36 * Math.pow((1 + nominalRate), B38)
               + B37 * B38 * Math.pow((1 + nominalRate), (B38 - 1));
      } else {
        // B39 != B40
        result = B36 * Math.pow((1 + nominalRate), B38)
               + B37 * (
                   ( Math.pow((1 + nominalRate), B38) - Math.pow((1 + savingGrowthRate), B38) )
                   / (nominalRate - savingGrowthRate)
                 );
      }

      // 결과 표시 (3자리 단위로 콤마)
      document.getElementById('resultValue').textContent = Math.round(result).toLocaleString();
    }

    /************************************************************
     * 4) 이벤트 리스너 설정
     ************************************************************/
    // 보유 자산
    const B36Input = document.getElementById('B36');
    B36Input.addEventListener('input', () => {
      formatInputAndDisplayUnit('B36');
      calculateRetirementAsset();
    });

    // 연간 저축 금액
    const B37Input = document.getElementById('B37');
    B37Input.addEventListener('input', () => {
      formatInputAndDisplayUnit('B37');
      calculateRetirementAsset();
    });

    // 기간(N년), 명목 수익률, 저축 증가율 → 단순 계산만
    document.getElementById('B38').addEventListener('input', calculateRetirementAsset);
    document.getElementById('B39').addEventListener('input', calculateRetirementAsset);
    document.getElementById('B40').addEventListener('input', calculateRetirementAsset);

  </script>
</body>
</html>
