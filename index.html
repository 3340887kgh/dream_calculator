<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>낙원 계산기</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      line-height: 1.6;
      max-width: 600px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .form-group {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    .form-group label {
      width: 120px;
    }
    .form-group input {
      width: 150px;
      padding: 5px;
      text-align: right; /* 숫자 오른쪽 정렬 */
    }
    .form-group span {
      margin-left: 5px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2em;
    }
    .hint {
      color: #666;
      margin-left: 10px;
    }
    /* 괄호 안 수치를 20% 더 작게 보이도록 설정 */
    .detail {
      font-size: 0.8em; 
      color: #333;
      margin-left: 6px;
    }
  </style>
</head>
<body>

  <h1>낙원 계산기</h1>
  <p>아래 값을 입력하면, 은퇴(낙원) 후 예상 자산이 즉시 계산됩니다.</p>

  <!-- 보유 자산 -->
  <div class="form-group">
    <label for="B36">보유 자산</label>
    <input type="text" id="B36" placeholder="예: 100,000,000" />
    <span>원</span>
    <span id="B36_million" class="hint">(0원)</span>
  </div>

  <!-- 연간 저축 금액 -->
  <div class="form-group">
    <label for="B37">연간 저축 금액</label>
    <input type="text" id="B37" placeholder="예: 12,000,000" />
    <span>원</span>
    <span id="B37_million" class="hint">(0원)</span>
  </div>

  <!-- 기간 (N년) -->
  <div class="form-group">
    <label for="B38">기간</label>
    <input type="number" id="B38" placeholder="예: 25" />
    <span>년</span>
  </div>

  <!-- 명목 수익률 -->
  <div class="form-group">
    <label for="B39">명목 수익률</label>
    <input type="number" id="B39" placeholder="예: 5" step="0.1" />
    <span>%</span>
  </div>

  <!-- 저축 증가율 -->
  <div class="form-group">
    <label for="B40">저축 증가율</label>
    <input type="number" id="B40" placeholder="예: 3" step="0.1" />
    <span>%</span>
  </div>

  <!-- 계산 결과 -->
  <div class="result">
    은퇴 후 자산: 
    <span id="resultValue">0원</span>
    <!-- 괄호 안에 전체 숫자를 20% 작은 폰트로 표기 -->
    <span id="resultValueDetail" class="detail">(0원)</span>
  </div>

  <script>
    /************************************************************
     * 1) 숫자 → 만원/억/조/경/해 단위로 변환하는 함수
     ************************************************************/
    function formatKoreanUnits(valueInWon) {
      if (valueInWon < 10000) {
        // 10,000원 미만 → 그냥 '원'
        return valueInWon.toLocaleString() + "원";
      }

      const UNIT_1MAN = 1e4;     // 만
      const UNIT_1EOK = 1e8;     // 억
      const UNIT_1JO  = 1e12;    // 조
      const UNIT_1GYEONG = 1e16; // 경
      const UNIT_1HAE = 1e20;    // 해

      if (valueInWon >= UNIT_1HAE) {
        // 해(10^20) 이상 → 그대로 원 표기
        return valueInWon.toLocaleString() + "원";
      } else if (valueInWon >= UNIT_1GYEONG) {
        const val = valueInWon / UNIT_1GYEONG;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "경원";
      } else if (valueInWon >= UNIT_1JO) {
        const val = valueInWon / UNIT_1JO;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "조원";
      } else if (valueInWon >= UNIT_1EOK) {
        const val = valueInWon / UNIT_1EOK;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "억원";
      } else {
        const val = valueInWon / UNIT_1MAN;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "만원";
      }
    }

    /************************************************************
     * 2) 입력 필드에 콤마 추가 + 단위 표기 (만원/억/조/경/해)
     ************************************************************/
    function formatInputAndDisplayUnit(id) {
      const inputElement = document.getElementById(id);
      let rawValueString = inputElement.value.replaceAll(",", "");
      let rawValue = parseFloat(rawValueString) || 0;

      // 3자리마다 콤마 추가
      let formattedValue = rawValue.toLocaleString();
      inputElement.value = formattedValue;

      // (xx만원/xx억원/...) 표기
      const spanElement = document.getElementById(id + "_million");
      if (spanElement) {
        spanElement.textContent = "(" + formatKoreanUnits(rawValue) + ")";
      }
    }

    /************************************************************
     * 3) 낙원(은퇴) 후 자산 계산 (엑셀 공식 그대로 적용)
     ************************************************************/
    function calculateRetirementAsset() {
      // 보유 자산와 연간 저축 금액은 콤마 제거 후 파싱
      const rawB36 = document.getElementById('B36').value.replaceAll(",", "") || "0";
      const rawB37 = document.getElementById('B37').value.replaceAll(",", "") || "0";
      const B36 = parseFloat(rawB36);
      const B37 = parseFloat(rawB37);
      const B38 = parseInt(document.getElementById('B38').value) || 0;   
      const B39 = parseFloat(document.getElementById('B39').value) || 0; 
      const B40 = parseFloat(document.getElementById('B40').value) || 0; 

      // 퍼센트 → 소수
      const nominalRate = B39 / 100;
      const savingGrowthRate = B40 / 100;

      let result = 0;
      if (nominalRate === savingGrowthRate) {
        // B39 == B40
        result = B36 * Math.pow(1 + nominalRate, B38) +
                 B37 * B38 * Math.pow(1 + nominalRate, B38 - 1);
      } else {
        // B39 != B40
        result = B36 * Math.pow(1 + nominalRate, B38) +
                 B37 * (
                   (Math.pow(1 + nominalRate, B38) - Math.pow(1 + savingGrowthRate, B38))
                   / (nominalRate - savingGrowthRate)
                 );
      }

      // 반올림된 결과값
      const roundedResult = Math.round(result);

      // 1) 단위 변환된 결과(만/억/조 등)
      const formattedUnit = formatKoreanUnits(roundedResult);
      // 2) 전체 숫자 (3자리 콤마)
      const formattedRaw = roundedResult.toLocaleString() + "원";

      // 표시
      document.getElementById('resultValue').textContent = formattedUnit;
      document.getElementById('resultValueDetail').textContent = "(" + formattedRaw + ")";
    }

    /************************************************************
     * 4) 이벤트 리스너 설정
     ************************************************************/
    // 보유 자산
    const B36Input = document.getElementById('B36');
    B36Input.addEventListener('input', () => {
      formatInputAndDisplayUnit('B36');
      calculateRetirementAsset();
    });

    // 연간 저축 금액
    const B37Input = document.getElementById('B37');
    B37Input.addEventListener('input', () => {
      formatInputAndDisplayUnit('B37');
      calculateRetirementAsset();
    });

    // 기간(N년), 명목 수익률, 저축 증가율 → 단순 계산
    document.getElementById('B38').addEventListener('input', calculateRetirementAsset);
    document.getElementById('B39').addEventListener('input', calculateRetirementAsset);
    document.getElementById('B40').addEventListener('input', calculateRetirementAsset);

  </script>
</body>
</html>
