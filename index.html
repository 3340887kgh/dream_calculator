<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>꿈 계산기</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      line-height: 1.6;
      max-width: 600px;
    }
    h1, h2 {
      margin-bottom: 10px;
    }
    .form-group {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    .form-group label {
      width: 120px; /* 모든 라벨 폭을 동일하게 */
    }
    .form-group input {
      width: 150px;
      padding: 5px;
      text-align: right; /* 숫자 오른쪽 정렬 */
    }
    .form-group span {
      margin-left: 5px;
    }
    .hint {
      color: #666;
      margin-left: 10px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2em;
    }
    .detail {
      font-size: 0.8em; 
      color: #333;
      margin-left: 6px;
    }
    .divider {
      margin: 30px 0;
      border-top: 1px solid #ccc;
    }
    button {
      margin-left: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- =========================
       (1) 원하는 월 생활비 → 미래에 필요한 목돈
       (기존 내용)
      ========================= -->
  <h1>꿈 계산기</h1>
  <p>
    현재의 물가로, 얼마의 월 생활비를 원하시나요? 필요한 목돈을 계산해드립니다.
  </p>
  <h2>원하는 월 생활비 → 미래에 필요한 목돈</h2>

  <!-- ... (중략) ... -->

  <!-- 구분선 -->
  <div class="divider"></div>

  <!-- =========================
       (2) 낙원 계산기
       (기존 내용)
      ========================= -->
  <h2>낙원 계산기</h2>
  <p>
    현재 보유한 자산과, 
    <span style="color:red; font-weight:bold;">연간</span>으로 얼마를 투자하는지 적어주세요.  
    그럼 은퇴 시점에 얼마의 자산을 가질 수 있는지 계산됩니다.
  </p>

  <!-- ... (중략) ... -->

  <!-- 구분선 -->
  <div class="divider"></div>

  <!-- =========================
       (3) 미래 목돈을 현재로 계산
       (기존 내용)
      ========================= -->
  <p>
    이 돈은 
    <span id="periodYears">0</span>
    년 후의 기준 가치입니다. 현재 기준으로는 얼마의 가치일까요? 환산해보겠습니다.
  </p>
  <h2>미래 목돈을 현재로 계산</h2>

  <!-- ... (중략) ... -->

  <!-- 구분선 -->
  <div class="divider"></div>

  <!-- =========================
       (4) 미래 목돈 → 인출 가능한 돈
       (기존 내용)
      ========================= -->
  <p>
    그럼, 위의 돈으로 <span id="withdrawYears">0</span>년 후 매달 얼마를 꺼내서 사용할 수 있을까요?
  </p>
  <h2>미래 목돈 → 인출 가능한 돈</h2>

  <!-- ... (중략) ... -->

  <!-- 구분선 -->
  <div class="divider"></div>

  <!-- =========================
       (5) [신규] 현재 가치를 미래 가치로 환산
      ========================= -->
  <h2>현재 가치를 미래 가치로 환산</h2>
  <p style="margin-bottom:10px;">
    예를 들어, 25년 뒤에 자녀에게 4억원을 물려주려면, 인플레이션이 3%일 때 8억 3,751만원이 필요합니다
  </p>

  <div class="form-group">
    <label for="FV_B2">현재 가치</label>
    <input type="text" id="FV_B2" placeholder="예: 400,000,000" />
    <span>원</span>
    <!-- 단위 표시 -->
    <span id="FV_B2_million" class="hint">(0원)</span>
  </div>

  <div class="form-group">
    <label for="FV_B3">인플레이션</label>
    <input type="number" id="FV_B3" placeholder="예: 3" step="0.1" />
    <span>%</span>
  </div>

  <div class="form-group">
    <label for="FV_B4">연수</label>
    <input type="number" id="FV_B4" placeholder="예: 25" />
    <span>년</span>
  </div>

  <div class="result">
    미래 가치: 
    <span id="FV_B5">0원</span>
    <span id="FV_B5Detail" class="detail">(0원)</span>
  </div>

  <script>
    /************************************************************
     * 기존 코드 (중략)...
     * 아래만 신규 섹션 관련 스크립트 추가
     ************************************************************/

    /************************************************************
     * (A) "현재 가치를 미래 가치로 환산" 계산
     *     FV_B2*(1 + FV_B3/100)^FV_B4
     ************************************************************/
    function calculateFutureValue() {
      const rawB2 = document.getElementById('FV_B2').value.replaceAll(",", "") || "0";
      const B2 = parseFloat(rawB2);

      const B3 = parseFloat(document.getElementById('FV_B3').value) || 0;
      const B4 = parseInt(document.getElementById('FV_B4').value) || 0;

      let futureVal = 0;
      if (B2 > 0 && B4 > 0) {
        futureVal = B2 * Math.pow(1 + B3/100, B4);
      }

      const roundedVal = Math.round(futureVal);

      // 표시
      document.getElementById('FV_B5').textContent = formatKoreanUnits(roundedVal);
      document.getElementById('FV_B5Detail').textContent =
        "(" + roundedVal.toLocaleString() + "원)";
    }

    /************************************************************
     * (B) 새 섹션 자동 동기화:
     *     "인플레이션/연수"를 위에서 설정한 값(C29/C28)을 가져온다
     *     (단, 사용자가 직접 수정하면 그 값 우선)
     ************************************************************/
    let userModifiedFV_B3 = false;
    let userModifiedFV_B4 = false;

    function syncFutureValueInputs() {
      // C29 → FV_B3 (인플레이션)
      if (!userModifiedFV_B3) {
        const c29Val = parseFloat(document.getElementById('C29').value) || 0;
        document.getElementById('FV_B3').value = c29Val.toString();
      }
      // C28 → FV_B4 (연수)
      if (!userModifiedFV_B4) {
        const c28Val = parseInt(document.getElementById('C28').value) || 0;
        document.getElementById('FV_B4').value = c28Val.toString();
      }

      calculateFutureValue();
    }

    /************************************************************
     * (C) 이벤트 리스너
     ************************************************************/
    // (C-1) 새 섹션: FV_B2(현재 가치)
    document.getElementById('FV_B2').addEventListener('input', () => {
      formatInputAndDisplayUnit('FV_B2');
      calculateFutureValue();
    });

    // (C-2) 새 섹션: FV_B3(인플레이션), FV_B4(연수)
    document.getElementById('FV_B3').addEventListener('input', () => {
      userModifiedFV_B3 = true;
      calculateFutureValue();
    });
    document.getElementById('FV_B4').addEventListener('input', () => {
      userModifiedFV_B4 = true;
      calculateFutureValue();
    });

    // (C-3) 기존 섹션 C28(연수), C29(인플레이션) 변경 시 => 새 섹션에 반영
    document.getElementById('C28').addEventListener('input', syncFutureValueInputs);
    document.getElementById('C29').addEventListener('input', syncFutureValueInputs);

    // 페이지 로드 시 초기 계산
    // (이미 기존 코드의 마지막에 있는 로직에 이어서)
    // => syncFutureValueInputs()도 함께 호출
    window.addEventListener('load', () => {
      syncFutureValueInputs();
    });
  </script>
</body>
</html>
