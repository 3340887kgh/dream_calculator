<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>낙원 계산기</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      line-height: 1.6;
      max-width: 600px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .form-group {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    .form-group label {
      width: 120px;
    }
    .form-group input {
      width: 150px;
      padding: 5px;
      text-align: right; /* 숫자 오른쪽 정렬 */
    }
    .form-group span {
      margin-left: 5px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2em;
    }
    .hint {
      color: #666;
      margin-left: 10px;
    }
  </style>
</head>
<body>

  <h1>낙원 계산기</h1>
  <p>아래 값을 입력하면, 은퇴(낙원) 후 예상 자산이 즉시 계산됩니다.</p>

  <!-- 보유 자산 -->
  <div class="form-group">
    <label for="B36">보유 자산</label>
    <!-- 예시 숫자에 콤마를 적용한 placeholder -->
    <input type="text" id="B36" placeholder="예: 100,000,000" />
    <span>원</span>
    <!-- (xx만원/xx억원/...) 표기용 -->
    <span id="B36_million" class="hint">(0원)</span>
  </div>

  <!-- 연간 저축 금액 -->
  <div class="form-group">
    <label for="B37">연간 저축 금액</label>
    <input type="text" id="B37" placeholder="예: 12,000,000" />
    <span>원</span>
    <span id="B37_million" class="hint">(0원)</span>
  </div>

  <!-- 기간 (N년) -->
  <div class="form-group">
    <label for="B38">기간</label>
    <input type="number" id="B38" placeholder="예: 25" />
    <span>년</span>
  </div>

  <!-- 명목 수익률 -->
  <div class="form-group">
    <label for="B39">명목 수익률</label>
    <input type="number" id="B39" placeholder="예: 5" step="0.1" />
    <span>%</span>
  </div>

  <!-- 저축 증가율 -->
  <div class="form-group">
    <label for="B40">저축 증가율</label>
    <input type="number" id="B40" placeholder="예: 3" step="0.1" />
    <span>%</span>
  </div>

  <!-- 계산 결과 -->
  <div class="result">
    은퇴 후 자산: <span id="resultValue">0</span>
  </div>

  <script>
    /************************************************************
     * 1) 숫자 → 만원/억/조/경/해 단위로 변환하는 함수
     ************************************************************/
    function formatKoreanUnits(valueInWon) {
      // valueInWon이 10000원 미만이면 원 그대로
      if (valueInWon < 10000) {
        return valueInWon.toLocaleString() + "원";
      }

      // 단위 정의
      const UNIT_1MAN = 1e4;    // 만 (10,000)
      const UNIT_1EOK = 1e8;    // 억 (100,000,000)
      const UNIT_1JO  = 1e12;   // 조 (1,000,000,000,000)
      const UNIT_1GYEONG = 1e16; // 경
      const UNIT_1HAE = 1e20;   // 해

      // 해 이상이면 원 단위 그대로 표기
      if (valueInWon >= UNIT_1HAE) {
        return valueInWon.toLocaleString() + "원";
      } else if (valueInWon >= UNIT_1GYEONG) {
        const val = valueInWon / UNIT_1GYEONG;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "경원";
      } else if (valueInWon >= UNIT_1JO) {
        const val = valueInWon / UNIT_1JO;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "조원";
      } else if (valueInWon >= UNIT_1EOK) {
        const val = valueInWon / UNIT_1EOK;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "억원";
      } else {
        const val = valueInWon / UNIT_1MAN;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "만원";
      }
    }

    /************************************************************
     * 2) 입력 필드에 콤마 추가 + 단위 표기 (만원/억/조/경/해)
     ************************************************************/
    function formatInputAndDisplayUnit(id) {
      const inputElement = document.getElementById(id);
      // 기존 값에서 콤마 제거
      let rawValueString = inputElement.value.replaceAll(",", "");
      let rawValue = parseFloat(rawValueString) || 0;

      // 3자리마다 콤마 추가
      let formattedValue = rawValue.toLocaleString();
      inputElement.value = formattedValue;

      // (xx만원/xx억원/...) 표기
      const spanElement = document.getElementById(id + "_million");
      if (spanElement) {
        spanElement.textContent = "(" + formatKoreanUnits(rawValue) + ")";
      }
    }

    /************************************************************
     * 3) 낙원(은퇴) 후 자산 계산 (엑셀 공식 그대로 적용)
     ************************************************************/
    function calculateRetirementAsset() {
      // 보유 자산와 연간 저축 금액은 콤마 제거 후 파싱
      const rawB36 = document.getElementById('B36').value.replaceAll(",", "") || "0";
      const rawB37 = document.getElementById('B37').value.replaceAll(",", "") || "0";
      const B36 = parseFloat(rawB36);
      const B37 = parseFloat(rawB37);
      const B38 = parseInt(document.getElementById('B38').value) || 0;    // 기간(년)
      const B39 = parseFloat(document.getElementById('B39').value) || 0;  // 명목 수익률(%)
      const B40 = parseFloat(document.getElementById('B40').value) || 0;  // 저축 증가율(%)

      // 퍼센트를 소수로 변환
      const nominalRate = B39 / 100;
      const savingGrowthRate = B40 / 100;

      let result = 0;
      if (nominalRate === savingGrowthRate) {
        result = B36 * Math.pow(1 + nominalRate, B38) +
                 B37 * B38 * Math.pow(1 + nominalRate, B38 - 1);
      } else {
        result = B36 * Math.pow(1 + nominalRate, B38) +
                 B37 * ((Math.pow(1 + nominalRate, B38) - Math.pow(1 + savingGrowthRate, B38)) / (nominalRate - savingGrowthRate));
      }

      // 결과를 단위 변환 적용하여 표시
      document.getElementById('resultValue').textContent = formatKoreanUnits(Math.round(result));
    }

    /************************************************************
     * 4) 이벤트 리스너 설정
     ************************************************************/
    // 보유 자산
    const B36Input = document.getElementById('B36');
    B36Input.addEventListener('input', () => {
      formatInputAndDisplayUnit('B36');
      calculateRetirementAsset();
    });

    // 연간 저축 금액
    const B37Input = document.getElementById('B37');
    B37Input.addEventListener('input', () => {
      formatInputAndDisplayUnit('B37');
      calculateRetirementAsset();
    });

    // 기간, 명목 수익률, 저축 증가율은 단순 계산 이벤트 설정
    document.getElementById('B38').addEventListener('input', calculateRetirementAsset);
    document.getElementById('B39').addEventListener('input', calculateRetirementAsset);
    document.getElementById('B40').addEventListener('input', calculateRetirementAsset);

  </script>
</body>
</html>
