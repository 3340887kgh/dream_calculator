<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>낙원 계산기</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      line-height: 1.6;
      max-width: 600px;
    }
    h1, h2 {
      margin-bottom: 10px;
    }
    .form-group {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
    }
    .form-group label {
      width: 120px;
    }
    .form-group input {
      width: 150px;
      padding: 5px;
      text-align: right; /* 숫자 오른쪽 정렬 */
    }
    .form-group span {
      margin-left: 5px;
    }
    .hint {
      color: #666;
      margin-left: 10px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
      font-size: 1.2em;
    }
    .detail {
      font-size: 0.8em; 
      color: #333;
      margin-left: 6px;
    }
    .divider {
      margin: 30px 0;
      border-top: 1px solid #ccc;
    }
    button {
      margin-left: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- 1) 낙원 계산기 섹션 -->
  <h1>낙원 계산기</h1>
  <p>
    현재 보유한 자산과, 
    <span style="color:red; font-weight:bold;">연간</span>으로 얼마를 투자하는지 적어주세요.  
    그럼 은퇴 시점에 얼마의 자산을 가질 수 있는지 계산됩니다.
  </p>

  <!-- 보유 자산 -->
  <div class="form-group">
    <label for="B36">보유 자산</label>
    <input type="text" id="B36" placeholder="예: 100,000,000" />
    <span>원</span>
    <span id="B36_million" class="hint">(0원)</span>
  </div>

  <!-- 연간 저축 금액 -->
  <div class="form-group">
    <label for="B37">
      <span style="color:red; font-weight:bold;">연간</span> 저축 금액
    </label>
    <input type="text" id="B37" placeholder="예: 12,000,000" />
    <span>원</span>
    <span id="B37_million" class="hint">(0원)</span>
  </div>

  <!-- 기간 (N년) -->
  <div class="form-group">
    <label for="B38">기간</label>
    <input type="number" id="B38" placeholder="예: 25" />
    <span>년</span>
  </div>

  <!-- 명목 수익률 -->
  <div class="form-group">
    <label for="B39">명목 수익률</label>
    <input type="number" id="B39" placeholder="예: 5" step="0.1" />
    <span>%</span>
  </div>

  <!-- 저축 증가율 (물가 상승률) -->
  <div class="form-group">
    <label for="B40">저축 증가율<br>(물가 상승률)</label>
    <input type="number" id="B40" placeholder="예: 3" step="0.1" />
    <span>%</span>
    <span class="hint">
      물가 상승에 맞춰, 저축 금액도 같은 비율로 매년 상승한다고 가정합니다
    </span>
  </div>

  <!-- 계산 결과 + 복사 버튼 -->
  <div class="result">
    은퇴 후 자산: 
    <span id="resultValue">0원</span>
    <span id="resultValueDetail" class="detail">(0원)</span>
    <button id="copyResultBtn">결과 복사하기</button>
  </div>

  <!-- 구분선 -->
  <div class="divider"></div>

  <!-- 2) 미래 가치 → 현재 가치 환산 안내 -->
  <p>
    이 돈은 
    <span id="periodYears">0</span>
    년 후의 기준 가치입니다. 현재 기준으로는 얼마의 가치일까요? 환산해보겠습니다.
  </p>

  <h2>미래 가치, 현재로 환산</h2>

  <!-- 미래 가치 -->
  <div class="form-group">
    <label for="B9">미래 가치</label>
    <input type="text" id="B9" placeholder="예: 0" />
    <span>원</span>
    <span id="B9_million" class="hint">(0원)</span>
  </div>

  <!-- 인플레이션 (%) -->
  <div class="form-group">
    <label for="B10">인플레이션</label>
    <input type="number" id="B10" placeholder="예: 3" step="0.1" />
    <span>%</span>
  </div>

  <!-- 연수 (몇 년 후?) -->
  <div class="form-group">
    <label for="B11">연수</label>
    <input type="number" id="B11" placeholder="예: 25" />
    <span>년</span>
  </div>

  <!-- 현재 가치 결과 -->
  <div class="result">
    현재 가치: 
    <span id="presentValue">0원</span>
    <span id="presentValueDetail" class="detail">(0원)</span>
  </div>

  <script>
    /************************************************************
     * 공통 함수 1) 숫자 → 만원/억/조/경/해 단위 변환
     ************************************************************/
    function formatKoreanUnits(valueInWon) {
      if (valueInWon < 10000) {
        return valueInWon.toLocaleString() + "원";
      }

      const UNIT_1MAN = 1e4;     // 만
      const UNIT_1EOK = 1e8;     // 억
      const UNIT_1JO  = 1e12;    // 조
      const UNIT_1GYEONG = 1e16; // 경
      const UNIT_1HAE = 1e20;    // 해

      if (valueInWon >= UNIT_1HAE) {
        return valueInWon.toLocaleString() + "원";
      } else if (valueInWon >= UNIT_1GYEONG) {
        const val = valueInWon / UNIT_1GYEONG;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "경원";
      } else if (valueInWon >= UNIT_1JO) {
        const val = valueInWon / UNIT_1JO;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "조원";
      } else if (valueInWon >= UNIT_1EOK) {
        const val = valueInWon / UNIT_1EOK;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "억원";
      } else {
        const val = valueInWon / UNIT_1MAN;
        return val.toLocaleString(undefined, { maximumFractionDigits: 2 }) + "만원";
      }
    }

    /************************************************************
     * 공통 함수 2) 입력 필드에 콤마 추가 + (만원/억/조/경/해) 표기
     ************************************************************/
    function formatInputAndDisplayUnit(id) {
      const inputElement = document.getElementById(id);
      let rawValueString = inputElement.value.replaceAll(",", "");
      let rawValue = parseFloat(rawValueString) || 0;

      // 3자리마다 콤마
      let formattedValue = rawValue.toLocaleString();
      inputElement.value = formattedValue;

      // (xx만원/xx억원/...) 표기
      const spanElement = document.getElementById(id + "_million");
      if (spanElement) {
        spanElement.textContent = "(" + formatKoreanUnits(rawValue) + ")";
      }
    }

    /************************************************************
     * 낙원 계산기: 은퇴 후 자산 계산
     ************************************************************/
    function calculateRetirementAsset() {
      // 1) 값 가져오기 (콤마 제거)
      const rawB36 = document.getElementById('B36').value.replaceAll(",", "") || "0";
      const rawB37 = document.getElementById('B37').value.replaceAll(",", "") || "0";
      const B36 = parseFloat(rawB36);
      const B37 = parseFloat(rawB37);
      const B38 = parseInt(document.getElementById('B38').value) || 0;    
      const B39 = parseFloat(document.getElementById('B39').value) || 0; 
      const B40 = parseFloat(document.getElementById('B40').value) || 0; 

      // 2) 명목 수익률/저축 증가율(물가상승률) → 소수
      const nominalRate = B39 / 100;
      const savingGrowthRate = B40 / 100;

      // 3) 엑셀 공식
      let result = 0;
      if (nominalRate === savingGrowthRate) {
        result = B36 * Math.pow(1 + nominalRate, B38)
               + B37 * B38 * Math.pow(1 + nominalRate, B38 - 1);
      } else {
        result = B36 * Math.pow(1 + nominalRate, B38)
               + B37 * (
                   ( Math.pow(1 + nominalRate, B38) - Math.pow(1 + savingGrowthRate, B38) )
                   / (nominalRate - savingGrowthRate)
                 );
      }

      // 4) 표시
      const roundedResult = Math.round(result);
      const formattedUnit = formatKoreanUnits(roundedResult);  // 만/억/조
      const formattedRaw = roundedResult.toLocaleString() + "원"; // 전체 원

      document.getElementById('resultValue').textContent = formattedUnit;
      document.getElementById('resultValueDetail').textContent = "(" + formattedRaw + ")";

      // 5) "XX년 후" 문구 갱신
      document.getElementById('periodYears').textContent = B38.toString();

      // 6) 미래 가치 환산 계산기의 "미래 가치(B9)"도 자동 세팅
      //    (사용자가 직접 수정할 수도 있음)
      const B9Input = document.getElementById('B9');
      B9Input.value = roundedResult.toLocaleString(); // 콤마 표시
      formatInputAndDisplayUnit('B9');
      calculatePresentValue(); // 자동으로 현재 가치 재계산
    }

    /************************************************************
     * 낙원 계산기: 복사하기 버튼
     ************************************************************/
    function copyResultToClipboard() {
      // 전체 숫자(소괄호 안)의 텍스트를 복사
      const detailText = document.getElementById('resultValueDetail').textContent;
      // 예: "(2,582,000,000원)"
      // 괄호 없이 복사하고 싶다면 slice 등을 사용 가능
      const textToCopy = detailText.replace(/\(|\)/g, ""); // 괄호 제거 예시

      navigator.clipboard.writeText(textToCopy)
        .then(() => alert("복사 완료!"))
        .catch(() => alert("복사 실패!"));
    }

    /************************************************************
     * 미래 가치 → 현재 가치 환산
     *  B12 = B9 / (1 + B10)^B11
     ************************************************************/
    function calculatePresentValue() {
      // 1) 값 가져오기
      const rawB9  = document.getElementById('B9').value.replaceAll(",", "") || "0";
      const B9  = parseFloat(rawB9); // 미래 가치
      const B10 = parseFloat(document.getElementById('B10').value) || 0; // 인플레이션(%)
      const B11 = parseInt(document.getElementById('B11').value) || 0;   // 연수

      // 2) 공식
      // B12 = B9 / (1 + B10)^B11
      const inflationRate = B10 / 100; 
      const present = B9 / Math.pow((1 + inflationRate), B11);

      // 3) 표시
      const roundedPresent = Math.round(present);
      const formattedUnit = formatKoreanUnits(roundedPresent); 
      const formattedRaw = roundedPresent.toLocaleString() + "원";

      document.getElementById('presentValue').textContent = formattedUnit;
      document.getElementById('presentValueDetail').textContent = "(" + formattedRaw + ")";
    }

    /************************************************************
     * 이벤트 리스너 설정
     ************************************************************/
    // 낙원 계산기 입력들
    const B36Input = document.getElementById('B36');
    B36Input.addEventListener('input', () => {
      formatInputAndDisplayUnit('B36');
      calculateRetirementAsset();
    });

    const B37Input = document.getElementById('B37');
    B37Input.addEventListener('input', () => {
      formatInputAndDisplayUnit('B37');
      calculateRetirementAsset();
    });

    document.getElementById('B38').addEventListener('input', calculateRetirementAsset);
    document.getElementById('B39').addEventListener('input', calculateRetirementAsset);
    document.getElementById('B40').addEventListener('input', calculateRetirementAsset);

    // 복사하기 버튼
    document.getElementById('copyResultBtn').addEventListener('click', copyResultToClipboard);

    // 미래 가치 → 현재 가치 환산 입력들
    const B9Input = document.getElementById('B9');
    B9Input.addEventListener('input', () => {
      formatInputAndDisplayUnit('B9');
      calculatePresentValue();
    });
    document.getElementById('B10').addEventListener('input', calculatePresentValue);
    document.getElementById('B11').addEventListener('input', calculatePresentValue);

    // 페이지 로드 시 기본 계산 수행(필요하다면 초기값 설정)
    calculateRetirementAsset();
  </script>
</body>
</html>
