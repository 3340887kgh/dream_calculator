<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>생존 계산기</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      line-height: 1.6;
      max-width: 500px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: inline-block;
      width: 160px;
    }
    input[type="number"], input[type="text"] {
      width: 150px;
      text-align: right;
      padding: 5px;
    }
    .result {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>생존 계산기</h1>
  <p>아래 5개 항목을 입력하면, “몇 년 버틸 수 있는지”를 계산합니다.</p>
  <p>
    (엑셀 공식 기준:  
    <code>IF( OR(B49 &lt;= B50, 12*B48*(1+B50)^B46 = 0 ), "∞", IF( ... ))</code>
    )
  </p>

  <!-- B46: 연수 -->
  <div class="form-group">
    <label for="B46">연수 (B46)</label>
    <input type="number" id="B46" value="25" />
  </div>

  <!-- B47: 미래 목돈 (명목) -->
  <div class="form-group">
    <label for="B47">미래 목돈(명목) (B47)</label>
    <input type="text" id="B47" value="2000000000" />
  </div>

  <!-- B48: 현재 기준 월 생활비 -->
  <div class="form-group">
    <label for="B48">현재 기준 월 생활비 (B48)</label>
    <input type="text" id="B48" value="6000000" />
  </div>

  <!-- B49: 명목 수익률(%) -->
  <div class="form-group">
    <label for="B49">명목 수익률(%) (B49)</label>
    <input type="number" id="B49" value="10" step="0.1" />
  </div>

  <!-- B50: 인플레이션(%) -->
  <div class="form-group">
    <label for="B50">인플레이션(%) (B50)</label>
    <input type="number" id="B50" value="3" step="0.1" />
  </div>

  <!-- 결과 표시 -->
  <div class="result">
    몇 년 버틸 수 있을까? → <span id="B52">∞</span> 년
  </div>

  <script>
    // (1) 입력 필드에 콤마를 자동 삽입하기 위한 함수 (option)
    function formatInputNumber(id) {
      const el = document.getElementById(id);
      let raw = el.value.replaceAll(",", "");
      let num = parseFloat(raw) || 0;
      // 3자리마다 콤마
      el.value = num.toLocaleString();
      return num;
    }

    // (2) 생존 계산 공식 구현
    // =IF(
    //   OR(B49 <= B50, 12*B48*(1+B50)^B46 = 0),
    //   "∞",
    //   IF(
    //     B47*(B49 - B50)/(12*B48*(1+B50)^B46*(1 + B49)) >= 1,
    //     "∞",
    //     LN(1 - (...)) / LN((1 + B50)/(1 + B49))
    //   )
    // )
    function calculateSurvival() {
      // 2-1) 입력값 가져오기
      const B46 = parseFloat(document.getElementById('B46').value) || 0; // 연수
      const rawB47 = document.getElementById('B47').value.replaceAll(",", "") || "0";
      const B47 = parseFloat(rawB47); // 미래 목돈(명목)
      const rawB48 = document.getElementById('B48').value.replaceAll(",", "") || "0";
      const B48 = parseFloat(rawB48); // 현재 기준 월 생활비
      const B49 = (parseFloat(document.getElementById('B49').value) || 0) / 100; // 명목 수익률
      const B50 = (parseFloat(document.getElementById('B50').value) || 0) / 100; // 인플레이션

      const resultEl = document.getElementById('B52');

      // 2-2) 조건 1: 명목수익률 <= 인플레이션 OR 12*B48*(1+B50)^B46 == 0
      if (B49 <= B50 || (12 * B48 * Math.pow(1 + B50, B46) === 0)) {
        resultEl.textContent = "∞";
        return;
      }

      // 2-3) X = B47*(B49 - B50)/(12*B48*(1+B50)^B46*(1 + B49))
      const numerator = B47 * (B49 - B50);
      const denominator = 12 * B48 * Math.pow(1 + B50, B46) * (1 + B49);
      if (denominator === 0) {
        resultEl.textContent = "∞";
        return;
      }
      const X = numerator / denominator;

      // 2-4) 조건 2: if X >= 1 => "∞"
      if (X >= 1) {
        resultEl.textContent = "∞";
        return;
      }

      // 2-5) 실제 계산: LN(1 - X) / LN((1 + B50)/(1 + B49))
      const topVal = 1 - X;
      if (topVal <= 0) {
        resultEl.textContent = "∞";
        return;
      }
      const bottomVal = Math.log((1 + B50) / (1 + B49));
      if (bottomVal <= 0) {
        resultEl.textContent = "∞";
        return;
      }

      const survivalYears = Math.log(topVal) / bottomVal;
      if (survivalYears < 0) {
        resultEl.textContent = "∞";
        return;
      }

      // 소수 둘째 자리까지 반올림
      const rounded = Math.round(survivalYears * 100) / 100;
      resultEl.textContent = rounded.toLocaleString();
    }

    // (3) 이벤트 리스너
    document.getElementById('B46').addEventListener('input', calculateSurvival);
    document.getElementById('B47').addEventListener('input', () => {
      formatInputNumber('B47');
      calculateSurvival();
    });
    document.getElementById('B48').addEventListener('input', () => {
      formatInputNumber('B48');
      calculateSurvival();
    });
    document.getElementById('B49').addEventListener('input', calculateSurvival);
    document.getElementById('B50').addEventListener('input', calculateSurvival);

    // (4) 초기 계산
    formatInputNumber('B47');
    formatInputNumber('B48');
    calculateSurvival();
  </script>
</body>
</html>
